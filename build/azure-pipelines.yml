variables:
- template: version.yml

name: $(version)

trigger:
  branches:
    include:
    - master

pr: none

pool:
  vmImage: 'ubuntu-16.04'

steps:
- template: templates/build-test.yml
  parameters:
    buildConfiguration: Release

- template: templates/pack-publish.yml

- script: |
    git config --global user.name "Azure DevOps"
    git config --global user.email "fake@dev.azure.com"
    git tag -a $(Build.BuildNumber) -m "v$(Build.BuildNumber)"
    git push origin $(Build.BuildNumber)
  workingDirectory: $(Build.SourcesDirectory)
  displayName: Tag source